################################################################################
#
#  MCRADIA
#
# Makefile for RADIA4.3, simply type make on OSX, AIX, IRIX, OSF1, HP-UX, SunOS 
# or Linux to build the programme. Type make gulp_debug to build programme with 
# debugging on, type make clean to remove all objects or make clean_debug to 
# remove all objects from version with debug information. Type make tar to 
# create gzipped tar file of source code, documentation and examples. Type make 
# html to convert help.txt to help.html.
#
# Original makefile by O. Chubar, adapted for MCRADIA by AP
#
# Portions of this makefile require the use of GNU make.
# see http://www.gnu.org/software/make for more information.
#
################################################################################

SYS=		Linux-x86-64

# Variables relating to Mathematica local installation
MATHVERSION=	9.0
MLORIGDIR=	/usr/local/Wolfram/Mathematica/${MATHVERSION}/SystemFiles/Links/MathLink/DeveloperKit/${SYS}/CompilerAdditions
MLINCLUDEDIR=	$(MLORIGDIR)
MLINCLUDE=	-I$(MLINCLUDEDIR)
MLLIBDIR=	$(MLORIGDIR)
MLMPREP=	/usr/local/Wolfram/Mathematica/9.0/SystemFiles/Links/MathLink/DeveloperKit/Linux-x86-64/CompilerAdditions/mprep

# McRadia source directory
SOFTDEVDIR=	/home/andrea/devel/radia/mcradia
RADSRCDIR=	$(SOFTDEVDIR)/src
RADSRCGENDIR=	$(RADSRCDIR)/general
RADSRCTRIDIR=	$(RADSRCDIR)/triangle
RADSRCMLDIR=	$(RADSRCDIR)/mathlink
RADSRCDLLDIR=	$(RADSRCDIR)/dll
SHDIR=		$(SOFTDEVDIR)/shared
SHSRCDIR=	$(SHDIR)/src
SHSRCGMDIR=	$(SHSRCDIR)/genmath
SHSRCPARSEDIR=	$(SHSRCDIR)/auxparse
SHLIBDIR=	$(SHDIR)/lib
SHINCLUDE=	-I$(SHSRCGMDIR) -I$(SHSRCPARSEDIR)

CC = /usr/bin/gcc
#CC = /usr/bin/icc
CXX = /usr/bin/g++
#CXX = /usr/bin/icc

AR = ar
RM = rm

RADSRCDEF=	-D__GCC__ -D__MATHEMATICA__ -DFFTW_ENABLE_FLOAT -DNO_TIMER -DANSI_DECLARATORS -DTRILIBRARY -DLINUX

CFLAGS=		-O3 $(RADSRCDEF) $(MLINCLUDE) $(SHINCLUDE) -I$(RADSRCTRIDIR) -march=corei7-avx -mtune=corei7

LIB=		-L$(MLLIBDIR) -lML64i3 -L$(SHLIBDIR) -lfftw -lm -lpthread -lrt

OBJS= 		radia_tm_linux.o radapl1.o radapl2.o radapl3.o radapl4.o radapl5.o radapl6.o radapl7.o radarccu.o radcast.o radexpgn.o radflm.o radg3d.o radg3dgr.o radgroup.o radinter.o radintrc.o radiobuf.o radmamet.o radmater.o radplnr1.o radplnr2.o radptrj.o radrec.o radrlmet.o radsbdac.o radsbdep.o radsbdrc.o radsbdvp.o radsend.o radvlpgn.o gmtrans.o gmfft.o triangle.o auxparse.o

OBJSLIB= 	radapl1.o radapl2.o radapl3.o radapl4.o radapl5.o radapl6.o radapl7.o radarccu.o radcast.o radexpgn.o radflm.o radg3d.o radg3dgr.o radgroup.o radintrc.o radiobuf.o radmamet.o radmater.o radplnr1.o radplnr2.o radptrj.o radrec.o radrlmet.o radsbdac.o radsbdep.o radsbdrc.o radsbdvp.o radsend.o radvlpgn.o gmtrans.o gmfft.o triangle.o auxparse.o radentry.o


MLRADIA=	Radia.exe
RADIALIB=	libradia.a

BINARIES = mlradia libradia

all : $(BINARIES)

libradia:	$(OBJSLIB) 
		$(AR) rcs $(RADIALIB) $(OBJS) 

mlradia:	$(OBJS)
		$(CXX) $(MLINCLUDE) $(OBJS) $(LIB) -o $(MLRADIA)

$(RADSRCMLDIR)/radia_tm_linux.c:	$(RADSRCMLDIR)/radia.tm
		$(MLMPREP) $? -o $@ 

radia_tm_linux.o:	$(RADSRCMLDIR)/radia_tm_linux.c 
		$(CC) $(CFLAGS) -c $(RADSRCMLDIR)/radia_tm_linux.c -O3 $(RADSRCDEF) $(MLINCLUDE)

%.o: $(RADSRCGENDIR)/%.cpp
	$(CC) $(CFLAGS) -c $<  

%.o: $(RADSRCGENDIR)/%.cpp
	$(CC) $(CFLAGS) -c $<  

gmtrans.o:	$(SHSRCGMDIR)/gmtrans.cpp 
		$(CC) $(CFLAGS) -c $(SHSRCGMDIR)/gmtrans.cpp -O3 $(RADSRCDEF)

gmfft.o:	$(SHSRCGMDIR)/gmfft.cpp 
		$(CC) $(CFLAGS) -c $(SHSRCGMDIR)/gmfft.cpp -O3 $(RADSRCDEF) 

auxparse.o:	$(SHSRCPARSEDIR)/auxparse.cpp 
		$(CC) $(CFLAGS) -c $(SHSRCPARSEDIR)/auxparse.cpp -O3 $(RADSRCDEF) 

radentry.o:	$(RADSRCDLLDIR)/radentry.cpp 
		$(CC) $(CFLAGS) -c $(RADSRCDLLDIR)/radentry.cpp -O3 $(RADSRCDEF) $(SHINCLUDE) -I$(RADSRCGENDIR)

clean:
		@ $(RM) -rf $(OBJS) $(OBJLIB) $(RADSRCMLDIR)/radia_tm_linux.c 

clobber:
		@ $(RM) -rf $(OBJS) $(OBJLIB) $(RADSRCMLDIR)/radia_tm_linux.c $(MLRADIA) $(RADIALIB)
